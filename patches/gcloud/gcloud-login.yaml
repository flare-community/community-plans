- op: add
  path: /spec/environment/GOOGLE_APPLICATION_CREDENTIALS
  value: "/workspace/gcp-svc-acc.json"

- op: add
  path: /spec/environment/CLOUDSDK_CONFIG
  value: "/workspace/.gcloud"

- op: add
  path: /spec/upsert/-
  value:
    #######################
    ###  GCLOUD LOGIN   ###
    #######################
    - name: gcloud-login
      image:
        url: google/cloud-sdk
        version: 335.0.0
      command: /bin/sh
      args:
        - -c
        - |
          set -eu
          printf '%s' '${{ getCipher "gcp-terraform-service-account" }}' > $GOOGLE_APPLICATION_CREDENTIALS
          gcloud auth activate-service-account --key-file=$GOOGLE_APPLICATION_CREDENTIALS

- op: add
  path: /spec/delete/-
  value:
    #######################
    ###  GCLOUD LOGIN   ###
    #######################
    - name: gcloud-login
      image:
        url: google/cloud-sdk
        version: 335.0.0
      command: /bin/sh
      args:
        - -c
        - |
          set -eu
          printf '%s' '${{ getCipher "gcp-terraform-service-account" }}' > $GOOGLE_APPLICATION_CREDENTIALS
          gcloud auth activate-service-account --key-file=$GOOGLE_APPLICATION_CREDENTIALS
